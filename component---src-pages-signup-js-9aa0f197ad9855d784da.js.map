{"version":3,"sources":["webpack:///./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteralLoose.js","webpack:///./src/pages/signup.js"],"names":["strings","raw","slice","Signup","setError","getValues","register","handleSubmit","watch","errors","clearErrors","useForm","allUsers","token","setCurrentUser","setAllUsers","React","useContext","Context","loading","setLoading","useState","randErr","setRandErr","id","className","onSubmit","async","GraphQLClient","glClient","gql","request","client","api","headers","Authorization","query","hash","data","pass","err","then","user","res","createTodoer","todoer","todoers","pullAllUsers","cacheToLocalStorage","jwtSecret","navigate","catch","findVal","match","type","message","placeholder","ref","required","err_msgs","validate","value","length","test","evalUname","name","as","minmax","nomatch","disabled","isEmpty","dataProcessLoader","to"],"mappings":"8QAAoDA,E,8SAC7CC,IACHA,EAAMD,EAAQE,MAAM,IAGtBF,EAAQC,IAAMA,EACPD,GANM,IAAqCA,EAASC,E,gCCoB9C,SAASE,IACvB,MAAM,SACLC,EADK,UAELC,EAFK,SAGLC,EAHK,aAILC,EAJK,MAKLC,EALK,OAMLC,EANK,YAOLC,GACGC,eAEE,SAAEC,EAAF,MAAYC,EAAZ,eAAmBC,EAAnB,YAAmCC,GAAgBC,IAAMC,WAC9DC,YAEMC,EAASC,GAAcJ,IAAMK,UAAS,IACtCC,EAASC,GAAcP,IAAMK,UAAS,GA+E7C,OACC,kBAAC,IAAD,KACC,2BAAIC,GAAW,0CAEf,yBAAKE,GAAG,UACP,yBAAKC,UAAU,gBACd,0BACCC,SAAUnB,EA1EOoB,UACrB,IACCP,GAAW,GACXG,GAAW,GAEX,MAAQK,cAAeC,EAAjB,IAA2BC,EAA3B,QAAgCC,SAAkB,gDAIlDC,EAAS,IAAIH,EAAYI,MAAhB,WAA+B,CAC7CC,QAAS,CACRC,cAAc,UAAWtB,KAIrBuB,EAAQN,EAAH,YAeU,4DAEdO,KAAKC,EAAKC,KAAM,GAAI,CAACC,EAAKH,KAChCC,EAAKC,KAAOF,EACZL,EACED,QAAQK,EAAOE,GACfG,KAAKd,UACLJ,GAAW,GACXH,GAAW,GACX,MAAMsB,EAAO,IAAKC,EAAIC,aAAaC,SAE7B,QAAEC,SAAkBC,uBAAalC,GAEvCE,EAAY+B,GACZhC,EAAe4B,GACfM,8BAAoBN,EAAMO,aAC1BC,mBAAS,WAETC,MAAMX,IACFY,kBAAQZ,EAAK,UAAUa,MAAM,WAChCjD,EAAS,QAAS,CACjBkD,KAAM,SACNC,QAAS,oBAGVhC,GAAW,GAGZH,GAAW,OAGb,MAAOoB,GACRjB,GAAW,GACXH,GAAW,MAYRK,UAAU,0EAEV,wBAAID,GAAG,SAAP,WACA,2BACC8B,KAAK,OACLE,YAAY,WACZ/B,UAAU,QACVD,GAAG,QACHiC,IAAKnD,EAAS,CACboD,SAAUC,WAAQ,SAClBC,SAAUC,GA/FCA,IACbA,EAAMC,OAAS,GAAKD,EAAMC,OAAS,GAC/BH,WAAQ,cACL,WAAWI,KAAKF,IACnBF,WAAQ,YA2FSK,CAAUH,KAE9BI,KAAK,UAGN,kBAAC,IAAD,CACCC,GAAG,IACHzC,UAAU,UACVhB,OAAQA,EACRwD,KAAK,UAGN,2BACCX,KAAK,WACLE,YAAY,WACZ/B,UAAU,QACVD,GAAG,OACHiC,IAAKnD,EAAS,CACboD,SAAUC,WAAQ,SAClBC,SAAU,CACTO,OAAQN,IACLA,EAAMC,OAAS,GAAKD,EAAMC,OAAS,KACpCH,WAAQ,cACT,KAGHM,KAAK,SAGN,kBAAC,IAAD,CACCC,GAAG,IACHzC,UAAU,UACVhB,OAAQA,EACRwD,KAAK,SAGN,2BACCX,KAAK,WACLE,YAAY,mBACZ/B,UAAU,QACVD,GAAG,YACHiC,IAAKnD,EAAS,CACboD,SAAU,yBACVE,SAAU,CACTQ,QAASP,GACRA,IAAUxD,EAAU,SAAWsD,WAAQ,gBAG1CM,KAAK,cAGN,kBAAC,IAAD,CACCC,GAAG,IACHzC,UAAU,UACVhB,OAAQA,EACRwD,KAAK,cAGN,yBAAKxC,UAAU,gDACd,4BACCD,GAAG,aACH8B,KAAK,SACL7B,UAAU,oCACV4C,SAAUlD,IAAYmD,kBAAQ7D,IAE7BU,EAAUoD,oBAAoB,UAEhC,kBAAC,OAAD,CAAMC,GAAG,SAAShD,GAAG,YAAYC,UAAU,uBAA3C","file":"component---src-pages-signup-js-9aa0f197ad9855d784da.js","sourcesContent":["export default function _taggedTemplateLiteralLoose(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  strings.raw = raw;\n  return strings;\n}","import React from \"react\"\nimport LoggedOut from \"../components/layout/loggedOut\"\nimport { Link, navigate } from \"gatsby\"\nimport { useForm } from \"react-hook-form\"\nimport { ErrorMessage } from \"@hookform/error-message\"\nimport {\n\terr_msgs,\n\tapi,\n\tdataProcessLoader,\n\tjwtSecret,\n} from \"../shared/constants\"\nimport { Context } from \"../components/wrapper\"\nimport {\n\tfindVal,\n\tevalUname,\n\tisEmpty,\n\tcacheToLocalStorage,\n\tpullAllUsers,\n} from \"../shared/utilities.js\"\n\nexport default function Signup() {\n\tconst {\n\t\tsetError,\n\t\tgetValues,\n\t\tregister,\n\t\thandleSubmit,\n\t\twatch,\n\t\terrors,\n\t\tclearErrors,\n\t} = useForm()\n\n\tconst { allUsers, token, setCurrentUser, setAllUsers } = React.useContext(\n\t\tContext\n\t)\n\tconst [loading, setLoading] = React.useState(false)\n\tconst [randErr, setRandErr] = React.useState(false)\n\n\tconst evalUname = value => {\n\t\tif (value.length < 3 || value.length > 10) {\n\t\t\treturn err_msgs[\"uname_minmax\"]\n\t\t} else if (/[^\\w-]+/g.test(value)) {\n\t\t\treturn err_msgs[\"uname_regex\"]\n\t\t} else {\n\t\t\treturn true\n\t\t}\n\t}\n\n\tconst onValidSubmit = async data => {\n\t\ttry {\n\t\t\tsetLoading(true)\n\t\t\tsetRandErr(false)\n\n\t\t\tconst { GraphQLClient: glClient, gql, request } = await import(\n\t\t\t\t\"graphql-request\"\n\t\t\t)\n\n\t\t\tconst client = new glClient(`${api}/graphql`, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t},\n\t\t\t})\n\n\t\t\tconst query = gql`\n\t\t\t\tmutation($uname: String!, $pass: String!) {\n\t\t\t\t\tcreateTodoer(input: { data: { uname: $uname, pass: $pass } }) {\n\t\t\t\t\t\ttodoer {\n\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\ttodos {\n\t\t\t\t\t\t\t\ttext\n\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`\n\n\t\t\t/* encryption */\n\t\t\tconst bcrypt = await import(\"bcryptjs\")\n\n\t\t\tbcrypt.hash(data.pass, 10, (err, hash) => {\n\t\t\t\tdata.pass = hash\n\t\t\t\tclient // send data\n\t\t\t\t\t.request(query, data)\n\t\t\t\t\t.then(async res => {\n\t\t\t\t\t\tsetRandErr(false)\n\t\t\t\t\t\tsetLoading(false)\n\t\t\t\t\t\tconst user = { ...res.createTodoer.todoer }\n\n\t\t\t\t\t\tconst { todoers } = await pullAllUsers(token)\n\n\t\t\t\t\t\tsetAllUsers(todoers)\n\t\t\t\t\t\tsetCurrentUser(user)\n\t\t\t\t\t\tcacheToLocalStorage(user, jwtSecret)\n\t\t\t\t\t\tnavigate(\"/user\")\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tif (findVal(err, \"detail\").match(/exists/g)) {\n\t\t\t\t\t\t\tsetError(\"uname\", {\n\t\t\t\t\t\t\t\ttype: \"manual\",\n\t\t\t\t\t\t\t\tmessage: \"That one exists\",\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetRandErr(true)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsetLoading(false)\n\t\t\t\t\t})\n\t\t\t})\n\t\t} catch (err) {\n\t\t\tsetRandErr(true)\n\t\t\tsetLoading(false)\n\t\t}\n\t}\n\n\treturn (\n\t\t<LoggedOut>\n\t\t\t<p>{randErr && \"Something went wrong, please try again\"}</p>\n\n\t\t\t<div id=\"signup\">\n\t\t\t\t<div className=\"card my-auto\">\n\t\t\t\t\t<form\n\t\t\t\t\t\tonSubmit={handleSubmit(onValidSubmit)}\n\t\t\t\t\t\tclassName=\"card-body d-flex align-items-center justify-content-center flex-column\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<h1 id=\"title\">Sign Up</h1>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tplaceholder=\"username\"\n\t\t\t\t\t\t\tclassName=\"field\"\n\t\t\t\t\t\t\tid=\"uname\"\n\t\t\t\t\t\t\tref={register({\n\t\t\t\t\t\t\t\trequired: err_msgs[\"required\"],\n\t\t\t\t\t\t\t\tvalidate: value => evalUname(value),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\tname=\"uname\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\tas=\"p\"\n\t\t\t\t\t\t\tclassName=\"err_msg\"\n\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\tname=\"uname\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\tplaceholder=\"password\"\n\t\t\t\t\t\t\tclassName=\"field\"\n\t\t\t\t\t\t\tid=\"pass\"\n\t\t\t\t\t\t\tref={register({\n\t\t\t\t\t\t\t\trequired: err_msgs[\"required\"],\n\t\t\t\t\t\t\t\tvalidate: {\n\t\t\t\t\t\t\t\t\tminmax: value =>\n\t\t\t\t\t\t\t\t\t\t((value.length < 3 || value.length > 20) &&\n\t\t\t\t\t\t\t\t\t\t\terr_msgs[\"pass_minmax\"]) ||\n\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\tname=\"pass\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\tas=\"p\"\n\t\t\t\t\t\t\tclassName=\"err_msg\"\n\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\tname=\"pass\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\tplaceholder=\"confirm password\"\n\t\t\t\t\t\t\tclassName=\"field\"\n\t\t\t\t\t\t\tid=\"conf_pass\"\n\t\t\t\t\t\t\tref={register({\n\t\t\t\t\t\t\t\trequired: \"This field is required\",\n\t\t\t\t\t\t\t\tvalidate: {\n\t\t\t\t\t\t\t\t\tnomatch: value =>\n\t\t\t\t\t\t\t\t\t\tvalue === getValues(\"pass\") || err_msgs[\"pass_nomatch\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\tname=\"conf_pass\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<ErrorMessage\n\t\t\t\t\t\t\tas=\"p\"\n\t\t\t\t\t\t\tclassName=\"err_msg\"\n\t\t\t\t\t\t\terrors={errors}\n\t\t\t\t\t\t\tname=\"conf_pass\"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<div className=\"row no-gutters w-100 justify-content-between\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"btn-submit\"\n\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\tclassName=\"align-self-start hvr-sweep-to-top\"\n\t\t\t\t\t\t\t\tdisabled={loading || !isEmpty(errors)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{loading ? dataProcessLoader : \"Submit\"}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<Link to=\"/login\" id=\"btn-login\" className=\"align-self-end mb-3\">\n\t\t\t\t\t\t\t\tLog In\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</LoggedOut>\n\t)\n}\n"],"sourceRoot":""}